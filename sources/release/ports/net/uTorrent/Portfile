PortSystem                  1.0

name                        uTorrent
version                     1.0.3
platforms                   macosx
categories                  net
maintainers                 pr0d1r2
license                     freeware
supported_archs             i386

description                 Torrent downloader

homepage                    http://www.utorrent.com/
master_sites                http://download.utorrent.com/mac/

use_dmg                     yes
distname                    uTorrent-Mac-23545

checksums           md5     d00ee7086a686ef8d8fa5b69f2e2f365 \
                    sha1    c43111049939ab46cb506e39c79cb7494d5df2a3 \
                    rmd160  e9d77bd4779fc1b47658f80e7889de5ef66da557

use_configure               no

build {}

pre-fetch {
    if {${os.platform} == "darwin" && ${os.major} < 9} {
        ui_error "${name} does only run on Mac OS X 10.5 or greater."
        return -code error "incompatible Mac OS X version"
    }
}

fetch {
    if {![file isdirectory ${distpath}]} {
        file mkdir ${distpath}
    }
    system "curl -C - ${master_sites}${distname}${extract.suffix} -o ${distpath}/${distname}${extract.suffix}"
}

extract {}

pre-destroot {
  file mkdir /tmp/${name}-${version}
  system "hdiutil attach ${distpath}/${distname}${extract.suffix} -private -readonly -nobrowse -mountpoint /tmp/${name}-${version}"
}

destroot {
  copy /tmp/${name}-${version}/${name}.app ${destroot}${applications_dir}
}

post-destroot {
  system "hdiutil detach /tmp/${name}-${version}"
  file delete -force /tmp/${name}-${version}
}
